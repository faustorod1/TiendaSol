openapi: 3.0.2
info:
  title: Tienda Sol API
  version: 1.0.0
  description: >-
    Una nueva API para la compra desde cualquier lugar, comparar productos, 
    acceder a múltiples métodos de pago y recibir los artículos en casa en pocos días.

tags:
  - name: Pedidos
    description: ''
  - name: Productos
    description: ''
  - name: Notificaciones
    description: ''

paths:
  /pedidos:
    summary: Operaciones de pedidos.
    get:
      tags:
        - Pedidos
      summary: Lista de pedidos del usuario autenticado
      description: Devuelve una lista de pedidos hechos por el usuario consultante.
      responses:
        '200':
          description: Retorno de historial exitoso.
        '400':
          description: El historial no está disponible o ha ocurrido un error.
    post:
      tags:
        - Pedidos
      summary: Crea un pedido
      description: Crea un pedido a partir de la información dentro del JSON body.
      requestBody:
        description: Datos del pedido a crear.
        required: true
        content:
          application/json:
            examples:
              pedidoEjemplo:
                value:
                  id: 123
                  comprador:
                    compradorId: 456
                    nombre: Brian Perez
                    email: Perez@example.com
                    telefono: '123456789'
                    tipo: COMPRADOR
                    fechaAlta: '2025-09-24T12:00:00Z'
                  vendedor:
                    vendedorId: 789
                    nombre: Tienda Sol
                    email: tienda@example.com
                    telefono: '987654321'
                    tipo: VENDEDOR
                    fechaAlta: '2024-01-15T09:30:00Z'
                  items:
                    - producto:
                        productoId: 321
                        vendedor:
                          vendedorId: 789
                          nombre: Tienda Sol
                          email: tienda@example.com
                          telefono: '987654321'
                          tipo: VENDEDOR
                          fechaAlta: '2024-01-15T09:30:00Z'
                        titulo: Notebook Gamer
                        descripcion: Notebook con RTX 3050
                        categorias:
                          - nombre: Electrónica
                        precio: 350000
                        moneda: PESO_ARG
                        stock: 10
                        fotos:
                          - 'https://miservidor.com/fotos/yo.jpg'
                          - 'https://miservidor.com/holamundo.jpg'
                        activo: true
                      cantidad: 2
                      precioUnitario: 350000
                  moneda: PESO_ARG
                  direccionEntrega:
                    calle: Av. Siempre Viva
                    altura: '742'
                    piso: '2'
                    departamento: B
                    codigoPostal: '1824'
                    ciudad: Lanús
                    provincia: Buenos Aires
                    pais: Argentina
                    lat: -34.702
                    lon: -58.396
      responses:
        '201':
          description: El pedido ha sido creado exitosamente.
        '400':
          description: Envía status 400 cuando no se envió bien el pedido.
        '409':
          description: No hay suficiente stock del producto solicitado.

  '/pedidos/{id}':
    patch:
      tags:
        - Pedidos
      summary: Cambiar el estado de un pedido
      description: >-
        Permite actualizar el estado de un pedido específico enviando su ID en la URL
        y el nuevo estado en el cuerpo de la solicitud. El sistema valida si el 
        usuario autenticado tiene permiso para realizar el cambio.
      parameters:
        - name: id
          in: path
          description: Identificador numérico del pedido que se desea modificar.
          required: true
          schema:
            type: integer
            format: int64
          example: 452
      requestBody:
        description: Es necesario enviar el nuevo estado para el pedido.
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                estado:
                  type: string
                  description: El nuevo estado del pedido.
                  enum: ["ENVIADO","CANCELADO"]
              required:
                - estado
            example:
              estado: "ENVIADO"
      responses:
        '200':
          description: Acción realizada con éxito. El estado del pedido fue actualizado.
        '400':
          description: Solicitud inválida. El ID del pedido no existe o el estado proporcionado no es válido.
        '401':
          description: Usuario no autorizado para realizar esta acción.

  /productos:
    get:
      tags:
        - Productos
      summary: Retorna productos paginados y filtrados
      description: >
        Retorna todos los productos de la base de datos, ordenados y filtrados según los parámetros de búsqueda.  
        Soporta paginación y filtros por vendedor, título, descripción, categoría, rango de precios y orden.
      parameters:
        - name: page
          in: query
          description: Número de página (entero positivo).
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Cantidad de productos por página (1 a 100).
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: vendedor
          in: query
          description: ID del vendedor (ObjectId de MongoDB).
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
        - name: titulo
          in: query
          description: Filtra productos cuyo título contenga el texto dado.
          schema:
            type: string
        - name: descripcion
          in: query
          description: Filtra productos por coincidencias en la descripción.
          schema:
            type: string
        - name: categoria
          in: query
          description: Nombre de la categoría a filtrar.
          schema:
            type: string
        - name: precioMin
          in: query
          description: Precio mínimo del producto (entero positivo).
          schema:
            type: number
            minimum: 0
        - name: precioMax
          in: query
          description: Precio máximo del producto (entero positivo).
          schema:
            type: number
            minimum: 0
        - name: orderBy
          in: query
          description: Criterio de ordenamiento.
          schema:
            type: string
            enum: [precio_asc, precio_desc, ventas_desc]
      responses:
        '200':
          description: Lista de productos obtenida correctamente.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginaDeProductos'
        '204':
          description: No se encontraron productos.
        '400':
          description: Parámetros inválidos (paginación o filtros).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /productos/{id}:
    get:
      tags:
        - Productos
      summary: Obtiene un producto por ID
      description: Devuelve la información del producto correspondiente al ID proporcionado.
      parameters:
        - name: id
          in: path
          required: true
          description: ID del producto (ObjectId válido de MongoDB).
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
      responses:
        '200':
          description: Producto encontrado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
        '400':
          description: ID inválido o error en la búsqueda.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Producto no encontrado.

  '/usuarios/{usuarioId}/notificaciones':
    get:
      tags:
        - Notificaciones
      summary: Obtiene notificaciones del usuario
      description: Se retornan las notificaciones del usuario que tenga el id enviado por parámetro.
      parameters:
        - name: usuarioId
          in: path
          description: Identificador del usuario.
          required: true
          schema:
            type: integer
          example: 351
        - name: Page
          in: query
          description: Número de página.
          schema:
            type: integer
        - name: Limit
          in: query
          description: Cantidad de notificaciones por página.
          schema:
            type: integer
      responses:
        '200':
          description: Envío de notificaciones con éxito.
        '500':
          description: Error al obtener notificaciones.

  '/usuarios/{usuarioId}/notificaciones/{id}':
    patch:
      tags:
        - Notificaciones
      summary: Marca una notificación como leída
      description: Se marca la notificación con el ID respectivo como leída para el usuario con el ID enviado por parámetro.
      parameters:
        - name: usuarioId
          in: path
          description: Identificador del usuario.
          required: true
          schema:
            type: integer
          example: 12
        - name: id
          in: path
          description: Identificador de la notificación.
          required: true
          schema:
            type: integer
          example: 42
      responses:
        '200':
          description: Notificación marcada como leída.
        '404':
          description: Notificación no encontrada.
        '500':
          description: El servidor no puede marcar la notificación como leída.

components:
  schemas:
    Producto:
      type: object
      properties:
        _id:
          type: string
          description: Identificador único del producto (ObjectId de MongoDB).
          example: "671e79a472eebc5e2c86efab"
        titulo:
          type: string
          example: "Notebook Gamer"
        descripcion:
          type: string
          example: "Notebook con RTX 3050"
        precio:
          type: number
          example: 350000
        moneda:
          type: string
          example: "PESO_ARG"
        stock:
          type: integer
          example: 10
        activo:
          type: boolean
          example: true
        categorias:
          type: array
          items:
            type: string
          example: ["Electrónica", "Computadoras"]
        vendedor:
          type: object
          properties:
            _id:
              type: string
              example: "671e79a472eebc5e2c86efac"
            nombre:
              type: string
              example: "Tienda Sol"
            email:
              type: string
              example: "tienda@example.com"
      required:
        - _id
        - titulo
        - descripcion
        - precio
        - moneda
        - stock
        - activo

    PaginaDeProductos:
      type: object
      properties:
        total:
          type: integer
          example: 52
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        data:
          type: array
          items:
            $ref: '#/components/schemas/Producto'

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Id inválido"
